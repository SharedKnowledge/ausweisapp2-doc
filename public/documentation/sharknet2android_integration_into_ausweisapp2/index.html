<html>
    <head>
        <meta charset="UTF-8">
        <title>SharkNet2Android integration into AusweisApp2</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/syntax.css">
    </head>
</html>

<body>
    <div class="wrapper">
        <div class="header"><h1>SharkNet2Android integration into AusweisApp2</h1></div>
        <div class="sidenav-left">
            <ul class="nav-dark">

    

    <li>
        <a href="/">
            
            <span>Ausweisapp2 Dokumentation</span>
        </a>
    </li>


    

    <li>
        <a href="/introduction/" onclick="collapsableNav(this)">
            <i class="fa fa-user"></i>
            <span>Introduction</span>
        </a>
        <ul class="sub-menu">
            
                

    <li>
        <a href="/introduction/participants/">
            <i class="fa fa-user"></i>
            <span>Participants</span>
        </a>
    </li>

            
                

    <li>
        <a href="/introduction/members/">
            <i class="fa fa-user"></i>
            <span>Project members</span>
        </a>
    </li>

            
        </ul>
    </li>


    

    <li>
        <a href="/infrastructure/">
            <i class="fa fa-user"></i>
            <span>Infrastructure</span>
        </a>
    </li>


    

    <li>
        <a href="/sdkintroduction/">
            <i class="fa fa-user"></i>
            <span>SDK introduction</span>
        </a>
    </li>


    

    <li>
        <a href="/sdkchanges/">
            
            <span>Fehlende Aspekte und Problematiken der AusweisApp2 (SDK)</span>
        </a>
    </li>


    

    <li>
        <a href="/solution/" onclick="collapsableNav(this)">
            <i class="fa fa-user"></i>
            <span>SDK Solution</span>
        </a>
        <ul class="sub-menu">
            
                

    <li>
        <a href="/solution/changes/">
            <i class="fa fa-user"></i>
            <span>SDK Changes</span>
        </a>
    </li>

            
                

    <li>
        <a href="/solution/operationprinciple/">
            <i class="fa fa-user"></i>
            <span>Operationprinciple</span>
        </a>
    </li>

            
        </ul>
    </li>


    

    <li>
        <a href="/changedsdk/" onclick="collapsableNav(this)">
            <i class="fa fa-user"></i>
            <span>Changed SDK</span>
        </a>
        <ul class="sub-menu">
            
                

    <li>
        <a href="/changedsdk/demo/">
            <i class="fa fa-user"></i>
            <span>Demo</span>
        </a>
    </li>

            
                

    <li>
        <a href="/changedsdk/advantagesanddisadvantages/">
            <i class="fa fa-user"></i>
            <span>Advantages and disadvantages</span>
        </a>
    </li>

            
        </ul>
    </li>


    

    <li>
        <a href="/integration/">
            <i class="fa fa-user"></i>
            <span>Integration into Sharksystems</span>
        </a>
    </li>


    

    <li>
        <a href="/conclusion/">
            <i class="fa fa-user"></i>
            <span>Conclusion</span>
        </a>
    </li>


    

    <li>
        <a href="/documentation/" onclick="collapsableNav(this)">
            <i class="fa fa-book"></i>
            <span>Documentation</span>
        </a>
        <ul class="sub-menu">
            
                

    <li>
        <a href="/documentation/needs_from_ausweisapp/">
            
            <span>Bedürfnisse an die AusweisApp</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/our_requirements_for_the_ausweisapp2/">
            
            <span>Unsere Anforderungen an die AusweisApp2</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/purchasing_scenarios/">
            <i class="fa fa-shopping-cart"></i>
            <span>Einkaufsszenarien</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/read_data_from_id_card/" onclick="collapsableNav(this)">
            <i class="fa fa-id-card-o"></i>
            <span>Read data from the ID card</span>
        </a>
        <ul class="sub-menu">
            
                

    <li>
        <a href="/documentation/read_data_from_id_card/kommunikation_mit_eigenem_eid/">
            
            <span>Communication with own eid service</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/read_data_from_id_card/self_auth_workflow/">
            
            <span>SelfAuth workflow</span>
        </a>
    </li>

            
        </ul>
    </li>

            
                

    <li>
        <a href="/documentation/identity_card_as_key/">
            <i class="fa fa-key"></i>
            <span>Ausweis als Key</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/fingerprint/">
            <i class="fa fa-print"></i>
            <span>Fingerabdruck</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/attack_scenarios/">
            
            <span>Angriffsszenarien</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/implementation_possibilities/">
            
            <span>Umsetzungsmöglichkeiten</span>
        </a>
    </li>

            
                

    <li>
        <a href="/documentation/sharknet2android_integration_into_ausweisapp2/">
            <div class="shark"></div>
            <span>SharkNet2Android integration into AusweisApp2</span>
        </a>
    </li>

            
        </ul>
    </li>


</ul>
        </div>
        <div class="body">
            
    <p>SharkNet2Android basiert auf dem ASAP Protokoll, das einen Austausch von Daten zwischen zwei Entitäten ermöglicht. Das Protokoll besitzt eine <a href="https://github.com/SharedKnowledge/ASAPJava">Java Implementierung</a>, diese wird von einer <a href="https://github.com/SharedKnowledge/ASAPAndroid">Android Implementierung</a> integriert, auf die <a href="https://github.com/SharedKnowledge/SharkNet2Android">SharkNet2Android</a> zugreift.</p>
<p>Es soll ein Paket net.sharksystem.android.eID eingerichtet werden, das Funktionalitäten zum Auslesen des elektronischen Personalausweises enthält.</p>
<h2 id="use-cases-für-eine-intgration-in-sharknet2android">Use Cases für eine Intgration in SharkNet2Android</h2>
<ul>
<li>Als Besitzer eines Gerätes auf dem SharkNet2Android installiert ist, möchte ich mich registrieren, indem ich einen Personalausweis auslese.</li>
<li>Als Besitzer eines Gerätes auf dem SharkNet2Android installiert ist, möchte ich Kontakte hinzufügen, indem ich einen Personalausweis auslese.</li>
</ul>
<h2 id="ansatzpunkt-für-die-integration">Ansatzpunkt für die Integration</h2>
<p>Die Klasse net.sharksystem.persons.android.PersonsStorageAndroid enthält Funktionen, um Kontakte zu verwalten. Die Klasse net.sharksystem.sharknet.android.SharkNetApp enthält eine Subklasse OwnerStorage, auf die die Klasse net.sharksystem.persons.android.OwnerActivity zugreift, um den Benutzernamen zu speichern. In der onSaveClick Methode soll der Owner wahlweise über das Package android.eID als alternative Eingabemethode gesetzt werden können.</p>
<h2 id="funktion-zum-setzen-des-benutzernamens-in-der-ausweisapp2activity">Funktion zum Setzen des Benutzernamens in der AusweisApp2Activity</h2>
<h3 id="in-der-datei-appsrcmainandroidmanifestxml-wird-der-einstiegspunkt-der-app-per-intent-filter-in-folgender-form-festgelegt">In der Datei <strong>app/src/main/AndroidManifest.xml</strong> wird der Einstiegspunkt der App per Intent-Filter in folgender Form festgelegt:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;activity</span>
    <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;.makan.android.MakanListActivity&#34;</span>
    <span style="color:#a6e22e">android:launchMode=</span><span style="color:#e6db74">&#34;singleTask&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;intent-filter&gt;</span>
        <span style="color:#f92672">&lt;action</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.intent.action.MAIN&#34;</span> <span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;category</span> <span style="color:#a6e22e">android:name=</span><span style="color:#e6db74">&#34;android.intent.category.LAUNCHER&#34;</span> <span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/intent-filter&gt;</span>
<span style="color:#f92672">&lt;/activity&gt;</span>
</code></pre></div><p>Es wird zunächst die MakanListActivity gestartet.</p>
<p><img src="android_main_intend.png" alt="Android main intend"></p>
<h3 id="beim-erstellen-der-makanlistactivity-wird-in-der-oncreate-methode-zunächst-die-oncreate-methode-der-oberklasse-sharknetactivity-ausgeführt">Beim Erstellen der MakanListActivity wird in der onCreate Methode zunächst die onCreate Methode der Oberklasse SharkNetActivity ausgeführt.</h3>
<p><img src="sharknetnctivity_oncreate.png" alt="Android main intend"></p>
<h3 id="ist-ein-nutzer-owner-nicht-bereits-festgelegt-wird-im-weiteren-verlauf-die-initactivity-gestartet-in-der-der-owner-durch-eingabe-des-nutzernamens-festgelegt-wird">Ist ein Nutzer (Owner) nicht bereits festgelegt, wird im weiteren Verlauf die InitActivity gestartet, in der der Owner durch Eingabe des Nutzernamens festgelegt wird.</h3>
<p><img src="sharknetactivity_oncreate_starts_initactivity.png" alt="SharkNetActivity onCreate starts init activity"></p>
<h3 id="integration-der-ausweisapp2-als-activity-in-sharknet2android">Integration der AusweisApp2 als Activity in SharkNet2Android</h3>
<p>Die Klasse muss von SharkNetActivity erben.</p>
<p>Der Konstruktor muss zunächst den Konstruktor von SharkNetActivity ausführen.</p>
<p>Die onCreate Methode muss zunächst onCreate von SharkNetActivity ausführen.</p>
<p>Damit eine Aktivität einen Rückgabewert erzeugt, muss die aufrufende Methode</p>
<ul>
<li>diese mit startActivityForResult() aufrufen</li>
<li>eine onActivityResult() Methode besitzen, die nach dem Beenden der aufgerufenen Aktivität den Rückgabewert von dieser auswertet</li>
</ul>
<p>Die Aktivität, die einen Rückgabewert liefert</p>
<ul>
<li>muss eine setResult() Methode besitzen, die in der finish() Methode einen Rückgabewert in Form eines Intents an die aufrufende Methode übergibt</li>
</ul>
<p><strong>In aufrufender Klasse (InitActivity)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUsername</span><span style="color:#f92672">(</span>View view<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Intent i <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Intent<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> AusweisApp2Activity<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        i<span style="color:#f92672">.</span><span style="color:#a6e22e">putExtra</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Value&#34;</span><span style="color:#f92672">);</span>
    startActivityForResult<span style="color:#f92672">(</span>i<span style="color:#f92672">,</span> REQUEST_CODE<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> i<span style="color:#f92672">.</span><span style="color:#a6e22e">getExtras</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">“</span>username<span style="color:#960050;background-color:#1e0010">”</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onActivityResult</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> requestCode<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> resultCode<span style="color:#f92672">,</span> Intent data<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>resultCode <span style="color:#f92672">==</span> RESULT_OK <span style="color:#f92672">&amp;&amp;</span> requestCode <span style="color:#f92672">==</span> REQUEST_CODE<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>data<span style="color:#f92672">.</span><span style="color:#a6e22e">hasExtra</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            data<span style="color:#f92672">.</span><span style="color:#a6e22e">getExtras</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><strong>In aufgerufener Klasse (AusweisApp2Activity)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">finish</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    Intent data <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Intent<span style="color:#f92672">();</span>
    data<span style="color:#f92672">.</span><span style="color:#a6e22e">putExtra</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">,</span> getUsername<span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    setResult<span style="color:#f92672">(</span>RESULT_OK<span style="color:#f92672">,</span> data<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">finish</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Quellen:</p>
<ul>
<li><a href="https://www.vogella.com/tutorials/AndroidIntent/article.html#retrieving-result-data-from-a-sub-activity">https://www.vogella.com/tutorials/AndroidIntent/article.html#retrieving-result-data-from-a-sub-activity</a></li>
</ul>


        </div>
        <div class="sidenav-right"></div>
        <div class="footer">Footer</div>
    </div>
</body>